{"version":3,"file":"transport.js","names":["_constants","require","_delimArray","_lookerSDKError","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","agentPrefix","exports","LookerAppId","tracing","trace","message","console","debug","ResponseMode","contentPatternString","RegExp","matchModeString","contentPatternBinary","matchModeBinary","charsetUtf8Pattern","matchCharsetUtf8","defaultTimeout","StatusCode","responseMode","contentType","match","string","binary","unknown","isUtf8","encodeParam","Date","toISOString","DelimArray","toString","encoded","JSON","stringify","decoded","decodeURIComponent","encodeURIComponent","e","URIError","encodeParams","values","keys","Object","filter","k","map","join","addQueryParams","path","obj","qp","concat","utf8","bufferString","val","result","decoder","TextDecoder","decode","Buffer","from","sdkError","response","LookerSDKError","errors","documentation_url","statusMessage","sdkOk","_x","_sdkOk","promise","ok","safeBase64","u8","rawBase64","btoa","String","fromCharCode","replace","isErrorLike","prototype","hasOwnProperty","call"],"sources":["../src/transport.ts"],"sourcesContent":["/*\n\n MIT License\n\n Copyright (c) 2021 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\nimport type { Agent } from 'https'\nimport type { Headers } from 'request'\nimport type { Readable } from 'readable-stream'\nimport { matchCharsetUtf8, matchModeBinary, matchModeString } from './constants'\nimport { DelimArray } from './delimArray'\nimport { LookerSDKError } from './lookerSDKError'\n\nexport const agentPrefix = 'TS-SDK'\nexport const LookerAppId = 'x-looker-appid'\n\n/** Set to `true` to follow streaming process */\nconst tracing = false\n\n/**\n * trivial tracing function that should be replaced with a log plugin\n * @param message description for trace\n * @param info any additional information to produce for output\n */\nexport function trace(message: string, info?: any) {\n  if (tracing) {\n    // eslint-disable-next-line no-console\n    console.debug(message)\n    if (info) {\n      // eslint-disable-next-line no-console\n      console.debug({ info })\n    }\n  }\n}\n\n/** ResponseMode for an HTTP request */\nexport enum ResponseMode {\n  'binary', // this is a binary response\n  'string', // this is a \"string\" response\n  'unknown', // unrecognized response type\n}\n\n/**\n * MIME patterns for string content types\n * @type {RegExp}\n */\nexport const contentPatternString = new RegExp(matchModeString, 'i')\n\n/**\n * MIME patterns for \"binary\" content types\n * @type {RegExp}\n */\nexport const contentPatternBinary = new RegExp(matchModeBinary, 'i')\n\n/**\n * MIME pattern for UTF8 charset attribute\n * @type {RegExp}\n */\nexport const charsetUtf8Pattern = new RegExp(matchCharsetUtf8, 'i')\n\n/**\n * Default request timeout\n * @type {number} default request timeout is 120 seconds, or two minutes\n */\nexport const defaultTimeout = 120\n\n/** Recognized HTTP methods */\nexport type HttpMethod =\n  | 'GET'\n  | 'POST'\n  | 'PUT'\n  | 'DELETE'\n  | 'PATCH'\n  | 'TRACE'\n  | 'HEAD'\n\n/**\n * HTTP status codes\n * https://developer.mozilla.org/en-US/docs/Web/HTTP/Status for reference\n * TODO is there a platform-agnostic list of these that can be used instead of this static declaration?\n */\nexport enum StatusCode {\n  OK = 200,\n  Created,\n  Accepted,\n  NonAuthoritative,\n  NoContent,\n  ResetContent,\n  PartialContent,\n  MultiStatus,\n  MultiStatusDav,\n  IMUsed = 226,\n  MultipleChoice = 300,\n  MovedPermanently,\n  Found,\n  SeeOther,\n  NotModified,\n  UseProxy,\n  UnusedRedirect,\n  TemporaryRedirect,\n  PermanentRedirect,\n  BadRequest = 400,\n  Unauthorized,\n  PaymentRequired,\n  Forbidden,\n  NotFound,\n  MethodNotAllowed,\n  NotAcceptable,\n  ProxyAuthRequired,\n  RequestTimeout,\n  Conflict,\n  Gone,\n  LengthRequired,\n  PreconditionFailed,\n  PayloadTooLarge,\n  UriTooLong,\n  UnsupportedMediaType,\n  RequestedRangeNotSatisfiable,\n  ExpectationFailed,\n  ImATeapot,\n  MisdirectedRequest = 421,\n  UnprocessableEntity,\n  Locked,\n  FailedDependency,\n  TooEarly,\n  UpgradeRequired,\n  PreconditionRequired = 428,\n  TooManyRequests,\n  RequestHeaderFieldsTooLarge = 431,\n  UnavailableForLegalReasons = 451,\n  InternalServerError = 500,\n  NotImplemented,\n  BadGateway,\n  ServiceUnavailable,\n  GatewayTimeout,\n  HttpVersionNotSupported,\n  VariantAlsoNegotiates,\n  InsufficientStorage,\n  LoopDetected,\n  NotExtended = 510,\n  NetworkAuthRequired,\n}\n\n/** Untyped basic HTTP response type for \"raw\" HTTP requests */\nexport interface IRawResponse {\n  /** Http method of the request */\n  method: HttpMethod\n  /** ok is `true` if the response is successful, `false` otherwise */\n  ok: boolean\n  /** HTTP request url */\n  url: string\n  /** HTTP response code */\n  statusCode: number\n  /** HTTP response status message text */\n  statusMessage: string\n  /** MIME type of the response from the HTTP response header */\n  contentType: string\n  /** The body of the HTTP response, without any additional processing */\n  body: any\n  /** Optional performance tracking starting mark name */\n  startMark?: string\n  /** Response headers */\n  headers: IRequestHeaders\n  /** Request start time */\n  requestStarted: number\n  /** Completion time for request */\n  responseCompleted: number\n}\n\n/** IRawResponse observer function type */\nexport type RawObserver = (raw: IRawResponse) => IRawResponse\n\n/** Transport plug-in interface */\nexport interface ITransport {\n  /** Observer lambda to process raw responses */\n  observer: RawObserver | undefined\n\n  /**\n   * HTTP request function for atomic, fully downloaded raw HTTP responses\n   *\n   * Note: This method returns the result of the HTTP request without any error handling\n   *\n   * @param method of HTTP request\n   * @param path request path, either relative or fully specified\n   * @param queryParams name/value pairs to pass as part of the URL\n   * @param body data for the body of the request\n   * @param authenticator authenticator callback, typically from `IAuthSession` implementation\n   * @param options overrides of default transport settings\n   * @returns typed response of `TSuccess`, or `TError` result\n   */\n  rawRequest(\n    method: HttpMethod,\n    path: string,\n    queryParams?: Values,\n    body?: any,\n    authenticator?: Authenticator,\n    options?: Partial<ITransportSettings>\n  ): Promise<IRawResponse>\n\n  /**\n   * HTTP request function for atomic, fully downloaded responses\n   * @param method of HTTP request\n   * @param path request path, either relative or fully specified\n   * @param queryParams name/value pairs to pass as part of the URL\n   * @param body data for the body of the request\n   * @param authenticator authenticator callback, typically from `IAuthSession` implementation\n   * @param options overrides of default transport settings\n   * @returns typed response of `TSuccess`, or `TError` result\n   */\n  request<TSuccess, TError>(\n    method: HttpMethod,\n    path: string,\n    queryParams?: Values,\n    body?: any,\n    authenticator?: Authenticator,\n    options?: Partial<ITransportSettings>\n  ): Promise<SDKResponse<TSuccess, TError>>\n\n  /**\n   * Processes the raw response, converting it into an SDKResponse\n   * @param raw response result\n   */\n  parseResponse<TSuccess, TError>(\n    raw: IRawResponse\n  ): Promise<SDKResponse<TSuccess, TError>>\n\n  /**\n   * HTTP request function for a streamable response\n   * @param callback that receives the stream response and pipes it somewhere\n   * @param method of HTTP request\n   * @param path request path, either relative or fully specified\n   * @param queryParams name/value pairs to pass as part of the URL\n   * @param body data for the body of the request\n   * @param authenticator authenticator callback, typically from `IAuthSession` implementation\n   * @param options overrides of default transport settings\n   * @returns `T` upon success\n   * @throws `ISDKErrorResponse` on failure\n   */\n  stream<T>(\n    callback: (readable: Readable) => Promise<T>,\n    method: HttpMethod,\n    path: string,\n    queryParams?: Values,\n    body?: any,\n    authenticator?: Authenticator,\n    options?: Partial<ITransportSettings>\n  ): Promise<T>\n}\n\n/** A successful SDK call. */\nexport interface ISDKSuccessResponse<T> {\n  /** Whether the SDK call was successful. */\n  ok: true\n  /** The object returned by the SDK call. */\n  value: T\n}\n\n/** An errant SDK call. */\nexport interface ISDKErrorResponse<T> {\n  /** Whether the SDK call was successful. */\n  ok: false\n  /** The error object returned by the SDK call. */\n  error: T\n}\n\n/** An error representing an issue in the SDK, like a network or parsing error. */\nexport interface ISDKError {\n  type: 'sdk_error'\n  message: string\n}\n\nexport type SDKResponse<TSuccess, TError> =\n  | ISDKSuccessResponse<TSuccess>\n  | ISDKErrorResponse<TError | ISDKError>\n\n/** Generic collection */\nexport interface IRequestHeaders {\n  [key: string]: string\n}\n\n/**\n * Generic http request property collection\n * TODO: Trim this down to what is required\n */\nexport interface IRequestProps {\n  [key: string]: any\n  /** full url for request, including any query params */\n  url: string\n\n  /** body of request. optional */\n  body?: any\n  /** headers for request. optional */\n  headers: IRequestHeaders\n  /** Http method for request. required. */\n  method: HttpMethod\n  /** Redirect processing for request. optional */\n  redirect?: any\n  /** Credentials to use */\n  credentials?: 'include' | 'omit' | 'same-origin' | undefined\n\n  /** http.Agent instance, allows custom proxy, certificate etc. */\n  agent?: Agent\n  /** support gzip/deflate content encoding. false to disable */\n  compress?: boolean\n  /** maximum redirect count. 0 to not follow redirect */\n  follow?: number\n  /** maximum response body size in bytes */\n  size?: number\n  /** req/res timeout in ms, it resets on redirect. 0 to disable (OS limit applies) */\n  timeout?: number\n}\n\n/** General purpose authentication callback */\nexport type Authenticator = (props: any) => any\n\n/** Interface for API transport values */\nexport interface ITransportSettings {\n  [key: string]: any\n  /** base URL of API REST web service */\n  base_url: string\n  /** standard headers to provide in all transport requests */\n  headers?: Headers\n  /** whether to verify ssl certs or not. Defaults to true */\n  verify_ssl: boolean\n  /** request timeout in seconds. Default to 30 */\n  timeout: number\n  /** encoding override */\n  encoding?: string | null\n  /** agent tag to use for the SDK requests */\n  agentTag: string\n}\n\n/**\n * Is the content type binary or \"string\"?\n * @param {string} contentType\n * @returns {ResponseMode.binary | ResponseMode.string}\n */\nexport function responseMode(contentType: string) {\n  if (contentType.match(contentPatternString)) {\n    return ResponseMode.string\n  }\n  if (contentType.match(contentPatternBinary)) {\n    return ResponseMode.binary\n  }\n  return ResponseMode.unknown\n}\n\n/**\n * Does this content type have a UTF-8 charset?\n * @param contentType\n * @returns match if it exists\n */\nexport function isUtf8(contentType: string) {\n  return contentType.match(/;.*\\bcharset\\b=\\butf-8\\b/i)\n}\n\n/** Used for name/value pair collections like for QueryParams */\nexport type Values = { [key: string]: any } | null | undefined\n\n/**\n * Encode parameter if not already encoded\n *\n * Note: this includes recognition of Date, DelimArray, and default objects for special handling\n *\n * @param value value of parameter\n * @returns URI encoded value\n */\nexport function encodeParam(value: any) {\n  if (value instanceof Date) {\n    value = value.toISOString()\n  } else if (value instanceof DelimArray) {\n    value = value.toString()\n  }\n  // check for object type to prevent \"[object Object]\" as the value.toString()\n  let encoded =\n    typeof value === 'object' ? JSON.stringify(value) : value.toString()\n\n  // decodeURIComponent throws URIError if there is a % character\n  // without it being part of an encoded\n  try {\n    const decoded = decodeURIComponent(value)\n    if (value === decoded) {\n      encoded = encodeURIComponent(value)\n    }\n  } catch (e) {\n    if (e instanceof URIError) {\n      encoded = encodeURIComponent(value)\n    } else {\n      throw e\n    }\n  }\n  return encoded\n}\n\n/**\n * Converts `Values` to query string parameter format\n * @param values Name/value collection to encode\n * @returns {string} query string parameter formatted values. Both `false` and `null` are included. Only `undefined` are omitted.\n */\nexport function encodeParams(values?: Values) {\n  if (!values) return ''\n\n  const keys = Object.keys(values)\n  return keys\n    .filter((k) => values[k] !== undefined) // `null` and `false` will both be passed\n    .map((k) => k + '=' + encodeParam(values[k]))\n    .join('&')\n}\n\n/**\n * constructs the path argument including any optional query parameters\n * @param path the base path of the request\n * @param obj optional collection of query parameters to encode and append to the path\n */\nexport function addQueryParams(path: string, obj?: Values) {\n  if (!obj) {\n    return path\n  }\n  const qp = encodeParams(obj)\n  return `${path}${qp ? '?' + qp : ''}`\n}\n\nconst utf8 = 'utf-8'\n\n/**\n * Convert this value to a string representation however we can do it\n * @param val\n */\nfunction bufferString(val: any) {\n  let result = 'Unknown error'\n  try {\n    const decoder = new TextDecoder(utf8)\n    result = decoder.decode(val)\n  } catch (e: any) {\n    // Supremely ugly hack. If we get here, we must be in Node (or IE 11, but who cares about that?)\n    // Node requires an import from `util` for TextDecoder to be found BUT it \"just has\" Buffer unless WebPack messes us up\n    try {\n      if (val instanceof Buffer) {\n        result = Buffer.from(val).toString(utf8)\n      } else {\n        result = JSON.stringify(val)\n      }\n    } catch (err: any) {\n      // The fallback logic here will at least give us some information about the error being thrown\n      result = JSON.stringify(val)\n    }\n  }\n  return result\n}\n\n/**\n * SDK error handler\n * @param response any kind of error\n * @returns a new `Error` object with the failure message\n */\nexport function sdkError(response: any) {\n  if (typeof response === 'string') {\n    return new LookerSDKError(response)\n  }\n  if ('error' in response) {\n    const error = response.error\n    if (typeof error === 'string') {\n      return new LookerSDKError(error)\n    }\n    // Try to get most specific error first\n    if ('error' in error) {\n      const result = bufferString(error.error)\n      return new LookerSDKError(result)\n    }\n    if ('message' in error) {\n      return new LookerSDKError(response.error.message.toString(), {\n        errors: error.errors,\n        documentation_url: error.documentation_url,\n      })\n    }\n    if ('statusMessage' in error) {\n      return new LookerSDKError(error.statusMessage)\n    }\n    const result = bufferString(error)\n    return new LookerSDKError(result)\n  }\n  if ('message' in response) {\n    return new LookerSDKError(response.message)\n  }\n  const error = JSON.stringify(response)\n  return new LookerSDKError(`Unknown error with SDK method ${error}`)\n}\n\n/** A helper method for simplifying error handling of SDK responses.\n *\n * Pass in a promise returned by any SDK method, and it will return a promise\n * that rejects if the `SDKResponse` is not `ok`. This will swallow the type\n * information in the error case, but allows you to route all the error cases\n * into a single promise rejection.\n *\n * The promise will have an `Error` rejection reason with a string `message`.\n * If the server error contains a `message` field, it will be provided, otherwise a\n * generic message will occur.\n *\n * ```ts\n * const sdk = LookerSDK({...})\n * let look\n * try {\n *    look = await sdkOk(sdk.create_look({...}))\n *    // do something with look\n * }\n * catch(e) {\n *    // handle error case\n * }\n * ```\n */\nexport async function sdkOk<TSuccess, TError>(\n  promise: Promise<SDKResponse<TSuccess, TError>>\n) {\n  const result = await promise\n  if (result.ok) {\n    return result.value\n  } else {\n    throw sdkError(result)\n  }\n}\n\n/**\n * Converts a byte array to a \"URL safe\" base64 string\n * @param u8 byte array to convert\n */\nexport function safeBase64(u8: Uint8Array) {\n  const rawBase64 = btoa(String.fromCharCode(...u8))\n  return rawBase64.replace(/\\+/g, '-').replace(/\\//g, '_')\n}\n\n/**\n * Type predicate. Asserts that a given object is error-like.\n * @param error a value of unknown type\n * @return boolean true if the error has a `message` key of type string.\n */\nexport function isErrorLike<T extends unknown>(\n  error: T\n): error is T & { message: string } {\n  if (typeof error !== 'object') return false\n  if (!error) return false\n  if (!Object.prototype.hasOwnProperty.call(error, 'message')) return false\n  if (typeof (error as unknown as { message: unknown }).message !== 'string')\n    return false\n  return true\n}\n"],"mappings":"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"}